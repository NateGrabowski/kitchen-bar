<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Bar Visualization - Option C</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        #container { width: 100vw; height: 100vh; }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 320px;
            z-index: 100;
        }
        h2 { margin-bottom: 15px; color: #333; font-size: 18px; }
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; color: #555; font-size: 13px; }
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="checkbox"] { margin-right: 8px; cursor: pointer; }
        .value { font-size: 12px; color: #888; margin-top: 3px; }
        .checkbox-label { display: flex; align-items: center; cursor: pointer; }
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
        }
        .dimension-note {
            background: #f0f7ff;
            border-left: 3px solid #3b82f6;
            padding: 10px;
            margin-top: 15px;
            font-size: 12px;
            color: #1e40af;
        }
        #viewButtons {
            margin-top: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        #viewButtons button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        #viewButtons button:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <div id="controls">
        <h2>Kitchen Bar - Option C</h2>

        <div class="control-group">
            <label>Bar Height (from kitchen floor): <span id="barHeightVal">40"</span></label>
            <input type="range" id="barHeight" min="36" max="44" value="40" step="1">
        </div>

        <div class="control-group">
            <label>Bar Depth: <span id="barDepthVal">25"</span></label>
            <input type="range" id="barDepth" min="18" max="30" value="25" step="1">
        </div>

        <div class="control-group">
            <label>Cabinet Height: <span id="cabinetHeightVal">20"</span></label>
            <input type="range" id="cabinetHeight" min="12" max="23" value="20" step="1">
            <div class="value">Max ~23" to fit in elevation drop</div>
        </div>

        <div class="control-group">
            <label class="checkbox-label">
                <input type="checkbox" id="showPillar" checked>
                Show Pillar
            </label>
        </div>

        <div class="control-group">
            <label class="checkbox-label">
                <input type="checkbox" id="showStools" checked>
                Show Bar Stools
            </label>
        </div>

        <div class="dimension-note">
            <strong>Current Setup:</strong><br>
            Bar: 84"W × <span id="depthDisplay">25"</span>D × <span id="heightDisplay">40"</span>H<br>
            Cabinets: 84"W × <span id="cabinetDisplay">20"</span>H<br>
            Elevation drop: 23.5"
        </div>

        <div id="viewButtons">
            <button onclick="setView('living')">Living Room View</button>
            <button onclick="setView('kitchen')">Kitchen View</button>
            <button onclick="setView('side')">Side View</button>
            <button onclick="setView('top')">Top View</button>
        </div>
    </div>

    <div id="info">
        Drag to rotate • Scroll to zoom • Right-drag to pan
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xe8e8e8);

        const container = document.getElementById('container');
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 30;
        controls.maxDistance = 400;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(80, 120, 80);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.near = 10;
        directionalLight.shadow.camera.far = 400;
        directionalLight.shadow.camera.left = -150;
        directionalLight.shadow.camera.right = 150;
        directionalLight.shadow.camera.top = 150;
        directionalLight.shadow.camera.bottom = -150;
        scene.add(directionalLight);

        const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
        fillLight.position.set(-60, 80, -60);
        scene.add(fillLight);

        // Materials
        const materials = {
            butcherBlock: new THREE.MeshStandardMaterial({
                color: 0xc4793a,
                roughness: 0.6,
                metalness: 0.0
            }),
            cabinet: new THREE.MeshStandardMaterial({
                color: 0x8B5A2B,
                roughness: 0.5,
                metalness: 0.0
            }),
            cabinetDark: new THREE.MeshStandardMaterial({
                color: 0x2d2d2d,
                roughness: 0.4,
                metalness: 0.1
            }),
            kitchenFloor: new THREE.MeshStandardMaterial({
                color: 0xc9a87c,
                roughness: 0.7
            }),
            livingRoomFloor: new THREE.MeshStandardMaterial({
                color: 0xb8956e,
                roughness: 0.5
            }),
            halfWall: new THREE.MeshStandardMaterial({
                color: 0xf0ebe3,
                roughness: 0.9
            }),
            pillar: new THREE.MeshStandardMaterial({
                color: 0xfafafa,
                roughness: 0.8
            }),
            wall: new THREE.MeshStandardMaterial({
                color: 0xf5ebe0,
                roughness: 0.9
            }),
            stool: new THREE.MeshStandardMaterial({
                color: 0x5c4033,
                roughness: 0.4
            }),
            metal: new THREE.MeshStandardMaterial({
                color: 0x666666,
                roughness: 0.2,
                metalness: 0.9
            })
        };

        // Conversion: inches to Three.js units (1 unit = 1 inch)
        const INCH = 1;
        const ELEVATION_DROP = 23.5 * INCH;
        const BAR_WIDTH = 84 * INCH;

        // Groups for dynamic elements
        let barGroup = new THREE.Group();
        let pillarGroup = new THREE.Group();
        let stoolGroup = new THREE.Group();
        scene.add(barGroup);
        scene.add(pillarGroup);
        scene.add(stoolGroup);

        // Create static environment
        function createEnvironment() {
            // Living room floor (lower level) - hardwood color
            const livingFloor = new THREE.Mesh(
                new THREE.BoxGeometry(250, 2, 200),
                materials.livingRoomFloor
            );
            livingFloor.position.set(0, -ELEVATION_DROP - 1, 75);
            livingFloor.receiveShadow = true;
            scene.add(livingFloor);

            // Kitchen floor (upper level) - tile color
            const kitchenFloor = new THREE.Mesh(
                new THREE.BoxGeometry(250, 2, 180),
                materials.kitchenFloor
            );
            kitchenFloor.position.set(0, -1, -60);
            kitchenFloor.receiveShadow = true;
            scene.add(kitchenFloor);

            // Half-wall / step between levels (the key structural element!)
            // This is what the current railing sits on
            const halfWall = new THREE.Mesh(
                new THREE.BoxGeometry(BAR_WIDTH + 20, ELEVATION_DROP, 8),
                materials.halfWall
            );
            halfWall.position.set(0, -ELEVATION_DROP / 2, 4);
            halfWall.castShadow = true;
            halfWall.receiveShadow = true;
            scene.add(halfWall);

            // Cap/ledge on top of half wall (where tile meets)
            const halfWallCap = new THREE.Mesh(
                new THREE.BoxGeometry(BAR_WIDTH + 22, 2, 12),
                materials.kitchenFloor
            );
            halfWallCap.position.set(0, 1, 4);
            scene.add(halfWallCap);

            // Back wall (kitchen side)
            const backWall = new THREE.Mesh(
                new THREE.BoxGeometry(250, 100, 4),
                materials.wall
            );
            backWall.position.set(0, 50, -150);
            scene.add(backWall);

            // Existing kitchen cabinets (background context)
            const existingCabinet = new THREE.Mesh(
                new THREE.BoxGeometry(70, 35, 24),
                materials.cabinet
            );
            existingCabinet.position.set(-80, 17.5, -135);
            existingCabinet.castShadow = true;
            scene.add(existingCabinet);

            // Countertop on existing cabinets
            const existingCounter = new THREE.Mesh(
                new THREE.BoxGeometry(72, 1.5, 26),
                materials.butcherBlock
            );
            existingCounter.position.set(-80, 35.75, -135);
            scene.add(existingCounter);
        }

        // Create bar structure
        function createBar(barHeight, barDepth, cabinetHeight) {
            // Clear previous
            while(barGroup.children.length > 0) {
                barGroup.remove(barGroup.children[0]);
            }

            const barHeightInch = barHeight * INCH;
            const barDepthInch = barDepth * INCH;
            const cabinetHeightInch = cabinetHeight * INCH;

            // Bar countertop (butcher block) - sits on kitchen level
            const countertop = new THREE.Mesh(
                new THREE.BoxGeometry(BAR_WIDTH, 1.5 * INCH, barDepthInch),
                materials.butcherBlock
            );
            // Position: top of bar at barHeight from kitchen floor (which is at y=0)
            countertop.position.set(0, barHeightInch - 0.75, -barDepthInch/2 + 4);
            countertop.castShadow = true;
            countertop.receiveShadow = true;
            barGroup.add(countertop);

            // Bar support/knee wall on kitchen side (under countertop)
            const kneeWallHeight = barHeightInch - 1.5;
            const kneeWall = new THREE.Mesh(
                new THREE.BoxGeometry(BAR_WIDTH - 2, kneeWallHeight, 3 * INCH),
                materials.cabinetDark
            );
            kneeWall.position.set(0, kneeWallHeight / 2, -barDepthInch + 6);
            kneeWall.castShadow = true;
            barGroup.add(kneeWall);

            // Cabinets facing living room (Option C: tucked in elevation zone)
            const cabinetDepth = barDepthInch - 6;

            // Main cabinet body - sits on living room floor
            const cabinetBody = new THREE.Mesh(
                new THREE.BoxGeometry(BAR_WIDTH - 4, cabinetHeightInch, cabinetDepth),
                materials.cabinetDark
            );
            // Living room floor is at y = -ELEVATION_DROP
            cabinetBody.position.set(0, -ELEVATION_DROP + cabinetHeightInch / 2, cabinetDepth/2 + 8);
            cabinetBody.castShadow = true;
            barGroup.add(cabinetBody);

            // Cabinet doors (3 doors) - facing living room (positive Z)
            const doorWidth = (BAR_WIDTH - 10) / 3;
            for (let i = 0; i < 3; i++) {
                const door = new THREE.Mesh(
                    new THREE.BoxGeometry(doorWidth - 3, cabinetHeightInch - 4, 0.75),
                    materials.cabinet
                );
                const xPos = (i - 1) * doorWidth;
                door.position.set(xPos, -ELEVATION_DROP + cabinetHeightInch / 2, cabinetDepth + 8.5);
                barGroup.add(door);

                // Door handles
                const handle = new THREE.Mesh(
                    new THREE.BoxGeometry(0.75, 4, 1.5),
                    materials.metal
                );
                handle.position.set(xPos + doorWidth/2 - 5, -ELEVATION_DROP + cabinetHeightInch / 2, cabinetDepth + 9.5);
                barGroup.add(handle);
            }

            // Filler section between cabinet top and bar (above the cabinets)
            const fillerHeight = ELEVATION_DROP - cabinetHeightInch + barHeightInch - 1.5;
            if (fillerHeight > 2) {
                const filler = new THREE.Mesh(
                    new THREE.BoxGeometry(BAR_WIDTH - 4, fillerHeight, cabinetDepth),
                    materials.cabinetDark
                );
                filler.position.set(0, -ELEVATION_DROP + cabinetHeightInch + fillerHeight/2, cabinetDepth/2 + 8);
                barGroup.add(filler);
            }
        }

        // Create pillar
        function createPillar(show) {
            while(pillarGroup.children.length > 0) {
                pillarGroup.remove(pillarGroup.children[0]);
            }

            if (!show) return;

            // Pillar sits at right edge of bar opening
            const pillarX = BAR_WIDTH / 2 + 12;

            // Pillar base (on living room floor level)
            const pillarBase = new THREE.Mesh(
                new THREE.BoxGeometry(10 * INCH, 10 * INCH, 10 * INCH),
                materials.pillar
            );
            pillarBase.position.set(pillarX, -ELEVATION_DROP + 5, 4);
            pillarBase.castShadow = true;
            pillarGroup.add(pillarBase);

            // Pillar column
            const columnHeight = 85 * INCH;
            const pillarColumn = new THREE.Mesh(
                new THREE.BoxGeometry(7 * INCH, columnHeight, 7 * INCH),
                materials.pillar
            );
            pillarColumn.position.set(pillarX, -ELEVATION_DROP + 10 + columnHeight/2, 4);
            pillarColumn.castShadow = true;
            pillarGroup.add(pillarColumn);

            // Pillar cap
            const pillarCap = new THREE.Mesh(
                new THREE.BoxGeometry(9 * INCH, 4 * INCH, 9 * INCH),
                materials.pillar
            );
            pillarCap.position.set(pillarX, -ELEVATION_DROP + 10 + columnHeight + 2, 4);
            pillarGroup.add(pillarCap);
        }

        // Create bar stools
        function createStools(show, barHeight) {
            while(stoolGroup.children.length > 0) {
                stoolGroup.remove(stoolGroup.children[0]);
            }

            if (!show) return;

            // Stool seat height should be ~10-12" below counter
            const seatHeight = (barHeight - 11) * INCH;
            const barDepth = parseInt(document.getElementById('barDepth').value);

            // 3 stools along the bar (kitchen side - negative Z from bar)
            const stoolPositions = [-26 * INCH, 0, 26 * INCH];
            const stoolZ = -barDepth - 8; // Behind the bar on kitchen side

            stoolPositions.forEach(xPos => {
                // Seat
                const seat = new THREE.Mesh(
                    new THREE.CylinderGeometry(7 * INCH, 6 * INCH, 2 * INCH, 16),
                    materials.stool
                );
                seat.position.set(xPos, seatHeight, stoolZ);
                seat.castShadow = true;
                stoolGroup.add(seat);

                // Leg
                const leg = new THREE.Mesh(
                    new THREE.CylinderGeometry(1.2 * INCH, 1.8 * INCH, seatHeight - 1, 8),
                    materials.metal
                );
                leg.position.set(xPos, (seatHeight - 1) / 2, stoolZ);
                leg.castShadow = true;
                stoolGroup.add(leg);

                // Footrest ring
                const footrest = new THREE.Mesh(
                    new THREE.TorusGeometry(5 * INCH, 0.6 * INCH, 8, 24),
                    materials.metal
                );
                footrest.rotation.x = Math.PI / 2;
                footrest.position.set(xPos, 14 * INCH, stoolZ);
                stoolGroup.add(footrest);
            });
        }

        // View presets
        function setView(viewName) {
            switch(viewName) {
                case 'living':
                    // View from living room looking at kitchen
                    camera.position.set(60, 30, 130);
                    controls.target.set(0, 10, 0);
                    break;
                case 'kitchen':
                    // View from kitchen looking at living room
                    camera.position.set(60, 50, -80);
                    controls.target.set(0, 10, 20);
                    break;
                case 'side':
                    // Side view to see the elevation
                    camera.position.set(130, 40, 30);
                    controls.target.set(0, 10, 0);
                    break;
                case 'top':
                    // Top-down view
                    camera.position.set(0, 150, 20);
                    controls.target.set(0, 0, 0);
                    break;
            }
            controls.update();
        }

        // Initialize
        createEnvironment();
        createBar(40, 25, 20);
        createPillar(true);
        createStools(true, 40);

        // Initial camera - angled view from living room side
        camera.position.set(80, 50, 110);
        controls.target.set(0, 10, 0);

        // Event listeners for controls
        document.getElementById('barHeight').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            document.getElementById('barHeightVal').textContent = val + '"';
            document.getElementById('heightDisplay').textContent = val + '"';
            const depth = parseInt(document.getElementById('barDepth').value);
            const cabHeight = parseInt(document.getElementById('cabinetHeight').value);
            createBar(val, depth, cabHeight);
            createStools(document.getElementById('showStools').checked, val);
        });

        document.getElementById('barDepth').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            document.getElementById('barDepthVal').textContent = val + '"';
            document.getElementById('depthDisplay').textContent = val + '"';
            const height = parseInt(document.getElementById('barHeight').value);
            const cabHeight = parseInt(document.getElementById('cabinetHeight').value);
            createBar(height, val, cabHeight);
            createStools(document.getElementById('showStools').checked, height);
        });

        document.getElementById('cabinetHeight').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            document.getElementById('cabinetHeightVal').textContent = val + '"';
            document.getElementById('cabinetDisplay').textContent = val + '"';
            const height = parseInt(document.getElementById('barHeight').value);
            const depth = parseInt(document.getElementById('barDepth').value);
            createBar(height, depth, val);
        });

        document.getElementById('showPillar').addEventListener('change', (e) => {
            createPillar(e.target.checked);
        });

        document.getElementById('showStools').addEventListener('change', (e) => {
            const height = parseInt(document.getElementById('barHeight').value);
            createStools(e.target.checked, height);
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
